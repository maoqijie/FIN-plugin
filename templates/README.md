# æ’ä»¶æ¨¡æ¿ç¤ºä¾‹

æœ¬ç›®å½•åŒ…å«å„ç§æ’ä»¶å¼€å‘æ¨¡æ¿å’Œç¤ºä¾‹ä»£ç ï¼Œå¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ FIN æ’ä»¶å¼€å‘ã€‚

## ğŸ“¦ å¯ç”¨æ¨¡æ¿

### åŸºç¡€ç¤ºä¾‹

#### 1. [bot/info](bot/info/) - æ§åˆ¶å°å‘½ä»¤ç¤ºä¾‹
å±•ç¤ºå¦‚ä½•æ³¨å†Œå’Œå¤„ç†æ§åˆ¶å°å‘½ä»¤ã€‚

**åŠŸèƒ½**ï¼š
- æ³¨å†Œæ§åˆ¶å°å‘½ä»¤ `info`
- æ˜¾ç¤ºæœºå™¨äººã€æœåŠ¡å™¨ã€QQ é€‚é…å™¨ä¿¡æ¯
- æ¼”ç¤º `Context` çš„åŸºæœ¬ç”¨æ³•

**é€‚åˆåœºæ™¯**ï¼šéœ€è¦æ·»åŠ ç®¡ç†å‘½ä»¤çš„æ’ä»¶

---

#### 2. [data_management](data_management/) - æ•°æ®ç›®å½•ç®¡ç†
å±•ç¤ºå¦‚ä½•ç®¡ç†æ’ä»¶æ•°æ®æ–‡ä»¶å’Œç›®å½•ã€‚

**åŠŸèƒ½**ï¼š
- ä½¿ç”¨ `DataPath()` è·å–æ•°æ®ç›®å½•
- ä½¿ç”¨ `FormatDataPath()` æ ¼å¼åŒ–æ–‡ä»¶è·¯å¾„
- æ¼”ç¤ºé…ç½®æ–‡ä»¶ã€ç©å®¶æ•°æ®ã€å¤‡ä»½ç®¡ç†
- é…åˆ `TempJSON` ä½¿ç”¨ç¤ºä¾‹

**é€‚åˆåœºæ™¯**ï¼šéœ€è¦ä¿å­˜é…ç½®æˆ–ç©å®¶æ•°æ®çš„æ’ä»¶

---

### é«˜çº§ç¤ºä¾‹

#### 3. [api_plugin](api_plugin/) - å‰ç½®æ’ä»¶ï¼ˆAPI æä¾›è€…ï¼‰
å±•ç¤ºå¦‚ä½•åˆ›å»ºå¯è¢«å…¶ä»–æ’ä»¶è°ƒç”¨çš„ API æ’ä»¶ã€‚

**åŠŸèƒ½**ï¼š
- æ³¨å†Œä¸º API æ’ä»¶
- æä¾›å…¬å…±æ–¹æ³•ç»™å…¶ä»–æ’ä»¶
- ç‰ˆæœ¬ç®¡ç†å’Œå…¼å®¹æ€§æ§åˆ¶

**é€‚åˆåœºæ™¯**ï¼šéœ€è¦æä¾›é€šç”¨åŠŸèƒ½ç»™å…¶ä»–æ’ä»¶çš„åŸºç¡€æ’ä»¶

---

#### 4. [api_consumer](api_consumer/) - API æ¶ˆè´¹è€…
å±•ç¤ºå¦‚ä½•ä½¿ç”¨å…¶ä»–æ’ä»¶æä¾›çš„ APIã€‚

**åŠŸèƒ½**ï¼š
- æŸ¥æ‰¾å¹¶è·å– API æ’ä»¶
- è°ƒç”¨å…¶ä»–æ’ä»¶çš„æ–¹æ³•
- ç‰ˆæœ¬æ£€æŸ¥å’Œå…¼å®¹æ€§å¤„ç†

**é€‚åˆåœºæ™¯**ï¼šéœ€è¦ä¾èµ–å…¶ä»–æ’ä»¶åŠŸèƒ½çš„æ’ä»¶

---

### å®Œæ•´åº”ç”¨ç¤ºä¾‹

#### 5. [shop](shop/) - å•†åº—ç³»ç»Ÿ â­
å®Œæ•´çš„æ¸¸æˆå†…å•†åº—ç³»ç»Ÿï¼Œå‚è€ƒ ToolDelta è®¾è®¡ã€‚

**åŠŸèƒ½**ï¼š
- åŒå‘äº¤æ˜“ç³»ç»Ÿï¼ˆè´­ä¹°/å‡ºå”®ï¼‰
- äº¤äº’å¼èœå•ç•Œé¢
- ç§¯åˆ†è´§å¸ç³»ç»Ÿ
- é…ç½®åŒ–ç‰©å“ç®¡ç†
- å®Œæ•´çš„äº¤æ˜“æµç¨‹å’ŒéªŒè¯
- è¶…æ—¶è‡ªåŠ¨æ¸…ç†

**æŠ€æœ¯äº®ç‚¹**ï¼š
- çŠ¶æ€æœºç®¡ç†ï¼ˆç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼‰
- é…ç½®æ–‡ä»¶é©±åŠ¨
- è®¡åˆ†æ¿é›†æˆ
- ç‰©å“å’Œè´§å¸éªŒè¯
- å¤šç©å®¶å¹¶å‘æ”¯æŒ

**é€‚åˆåœºæ™¯**ï¼š
- ç»æµç³»ç»Ÿæ’ä»¶
- æ¸¸æˆå†…äº¤æ˜“ç³»ç»Ÿ
- éœ€è¦å¤æ‚äº¤äº’æµç¨‹çš„æ’ä»¶

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é€‰æ‹©æ¨¡æ¿

æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ¨¡æ¿ï¼š

- **ç¬¬ä¸€æ¬¡å¼€å‘æ’ä»¶**ï¼Ÿä» `bot/info` å¼€å§‹
- **éœ€è¦ä¿å­˜æ•°æ®**ï¼ŸæŸ¥çœ‹ `data_management`
- **å¼€å‘å¤æ‚åŠŸèƒ½**ï¼Ÿå‚è€ƒ `shop` ç¤ºä¾‹
- **æä¾›é€šç”¨åŠŸèƒ½**ï¼Ÿå­¦ä¹  `api_plugin`

### 2. å¤åˆ¶æ¨¡æ¿

```bash
# å¤åˆ¶åˆ° Plugin/grpc ç›®å½•
cp -r templates/shop Plugin/grpc/my-shop

# æˆ–åœ¨æ§åˆ¶å°ä½¿ç”¨ create å‘½ä»¤åˆ›å»ºæ–°æ’ä»¶
```

### 3. ä¿®æ”¹ä»£ç 

ç¼–è¾‘ `main.go`ï¼Œå®ç°ä½ çš„åŠŸèƒ½é€»è¾‘ã€‚

### 4. ç¼–è¯‘è¿è¡Œ

```bash
cd Plugin/grpc/my-shop
go build -buildmode=plugin -o main.so main.go
```

æˆ–è€…ç›´æ¥å°† `.go` æ–‡ä»¶æ”¾å…¥æ’ä»¶ç›®å½•ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨ç¼–è¯‘ã€‚

## ğŸ“š å­¦ä¹ è·¯å¾„

### åˆçº§ï¼ˆå¿…å­¦ï¼‰

1. **bot/info** - äº†è§£æ’ä»¶ç»“æ„å’Œç”Ÿå‘½å‘¨æœŸ
2. **data_management** - å­¦ä¹ æ•°æ®ç®¡ç†

### ä¸­çº§

3. **api_plugin + api_consumer** - ç†è§£æ’ä»¶é—´åä½œ

### é«˜çº§

4. **shop** - ç ”ç©¶å®Œæ•´çš„åº”ç”¨æ¶æ„

## ğŸ¯ æ¨¡æ¿å¯¹æ¯”

| æ¨¡æ¿ | å¤æ‚åº¦ | ä»£ç é‡ | ä¸»è¦ API | å­¦ä¹ æ—¶é—´ |
|------|--------|--------|----------|----------|
| bot/info | â­ | 50 è¡Œ | Context, Console | 10 åˆ†é’Ÿ |
| data_management | â­â­ | 200 è¡Œ | DataPath, TempJSON, Config | 20 åˆ†é’Ÿ |
| api_plugin | â­â­ | 100 è¡Œ | RegisterPluginAPI | 15 åˆ†é’Ÿ |
| api_consumer | â­â­ | 80 è¡Œ | GetPluginAPI | 15 åˆ†é’Ÿ |
| shop | â­â­â­â­ | 350 è¡Œ | GameUtils, Config, ListenChat | 60 åˆ†é’Ÿ |

## ğŸ“– è¯¦ç»†æ–‡æ¡£

æ¯ä¸ªæ¨¡æ¿ç›®å½•éƒ½åŒ…å«ï¼š

- `main.go` - å®Œæ•´çš„æºä»£ç 
- `README.md` - è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜
- `go.mod` - ä¾èµ–é…ç½®

æŸ¥çœ‹å…·ä½“æ¨¡æ¿çš„ README äº†è§£æ›´å¤šç»†èŠ‚ã€‚

## ğŸ”§ å¼€å‘å»ºè®®

### ä»£ç ç»“æ„

```go
package main

import sdk "github.com/maoqijie/FIN-plugin/sdk"

type MyPlugin struct {
    ctx *sdk.Context
}

func (p *MyPlugin) Init(ctx *sdk.Context) error {
    p.ctx = ctx
    // åˆå§‹åŒ–ä»£ç 
    return nil
}

func (p *MyPlugin) Start() error {
    // å¯åŠ¨ä»£ç 
    return nil
}

func (p *MyPlugin) Stop() error {
    // åœæ­¢ä»£ç 
    return nil
}

func NewPlugin() sdk.Plugin {
    return &MyPlugin{}
}
```

### å¸¸ç”¨æ¨¡å¼

#### 1. ç›‘å¬äº‹ä»¶

```go
func (p *MyPlugin) Init(ctx *sdk.Context) error {
    // ç›‘å¬ç©å®¶åŠ å…¥
    ctx.ListenPlayerJoin(func(event sdk.PlayerEvent) {
        p.ctx.Logf("ç©å®¶ %s åŠ å…¥äº†æ¸¸æˆ", event.PlayerName)
    })

    // ç›‘å¬èŠå¤©
    ctx.ListenChat(func(event sdk.ChatEvent) {
        p.ctx.Logf("ç©å®¶ %s è¯´: %s", event.PlayerName, event.Message)
    })

    return nil
}
```

#### 2. é…ç½®ç®¡ç†

```go
type MyConfig struct {
    Enable bool   `json:"enable"`
    Value  int    `json:"value"`
}

func (p *MyPlugin) Init(ctx *sdk.Context) error {
    config, err := ctx.Config().GetConfig("config.json", &MyConfig{
        Enable: true,
        Value:  100,
    })
    if err != nil {
        return err
    }

    p.config = config.(*MyConfig)
    return nil
}
```

#### 3. æ•°æ®ä¿å­˜

```go
func (p *MyPlugin) saveData() error {
    path := p.ctx.FormatDataPath("data.json")
    data := map[string]interface{}{
        "players": p.players,
        "scores":  p.scores,
    }

    jsonData, _ := json.Marshal(data)
    return os.WriteFile(path, jsonData, 0644)
}
```

#### 4. æ¸¸æˆäº¤äº’

```go
func (p *MyPlugin) handlePlayer(playerName string) {
    // å‘é€æ¶ˆæ¯
    p.ctx.GameUtils().SayTo(playerName, "Â§aæ¬¢è¿ï¼")

    // è·å–åæ ‡
    pos, _ := p.ctx.GameUtils().GetPos(playerName)

    // è·å–åˆ†æ•°
    score, _ := p.ctx.GameUtils().GetScore("money", playerName, 5.0)

    // ä¼ é€ç©å®¶
    p.ctx.GameUtils().SendCommand(fmt.Sprintf(
        "tp \"%s\" 100 64 100", playerName,
    ))
}
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤æ–°çš„ç¤ºä¾‹æ¨¡æ¿ï¼

æäº¤è¦æ±‚ï¼š
1. ä»£ç æ¸…æ™°æ³¨é‡Š
2. å®Œæ•´çš„ README æ–‡æ¡£
3. æµ‹è¯•é€šè¿‡
4. éµå¾ªç°æœ‰ä»£ç é£æ ¼

## ğŸ“„ è®¸å¯è¯

æ‰€æœ‰æ¨¡æ¿éµå¾ªä¸»ä»“åº“çš„è®¸å¯è¯æ¡æ¬¾ã€‚
